<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui,user-scalable=1.0" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="format-detection" content="telephone=no">
		<link href="{S_URL}css/ucenter.css" rel="stylesheet">
		<script src="{S_URL}js/jquery-3.0.0.js"></script>
		<title>南京银行南京分行</title>
		<style>
            #address:focus::-webkit-input-placeholder{color: transparent;}
        </style>
	</head>
	<body>
		<div class="reader_person">
			<div class="person_head_bg"></div>
			<div class="person_head">
				<div class="head_img"><img src="{php echo $this->profile['avatar']}"></div>
				<!--未登录时显示-->
				<a class="sign_btn" {if $info['mobile']} style="display: none;"{/if}><img src="{S_URL}img/dlk.png"></a>
				<!--登录成功显示-->
				<div {if !$info['mobile']} style="display: none;"{/if}>
					<p class="head_name">{php echo $this->profile['nickname']}</p>
					<p class="head_word">新鲜、有趣，尽在南京银行南京分行</p>
				</div>
			</div>
			<div class="person_exchange">
				<img src="{S_URL}img/img1.png">
				<a {if $info['mobile']} href="{$_W['siteroot']}app/index.php?i={$_W['uniacid']}&c=entry&do=entry&m=viva_njyh_njfh_jfdh"{else} class="exchange" {/if}>点击查看</a>
			</div>
			<div class="person_integral">
				<div class="integl_left"></div>
				<div class="integl_right">
					<div class="integl_div1">
						<img src="{S_URL}img/img2.png">
						<div>{if $info['mobile']}个人积分:{php echo round($this->member['credit1'] + $this->member['credit2'])}分{else}个人积分{/if}</div>
					</div>
					<div class="integl_div2">
						<i>&#xe625;</i>
						<div>
							<p>阅读有礼</p>
							<a {if $info['mobile']} href="{$_W['siteroot']}app/index.php?i={$_W['uniacid']}&c=entry&do=entry&m=viva_njyh_njfh_ydyl"{else} class="reading" {/if}>赚积分</a>
						</div>
					</div>
					<div class="integl_div2">
						<i style="color:#71b2ff;">&#xe601;</i>
						<div style="border: none;">
							<p>签到</p>
							<a {if $info['mobile']} href="{$_W['siteroot']}app/index.php?i={$_W['uniacid']}&c=entry&do=entry&m=viva_njyh_njfh_mrqd"{else} class="rate" {/if}>赚积分</a>
						</div>
					</div>
				</div>
			</div>
			<div class="person_integral person_integra2">
				<div class="integl_left"></div>
				<div class="integl_right">
					<div class="integl_div2">
						<img src="{S_URL}img/img3.png">
						<div>
							<p>个人资料完善度：{$percent}%</p>
							<a class="bianji">编辑</a>
						</div>
					</div>				
				</div>
			</div>
			<div class="person_integral person_integra2">
				<div class="integl_left"></div>
				<div class="integl_right">
					<div class="integl_div2">
						<img src="{S_URL}img/img4.png">
						<div>
							<p>我的兑换记录</p>
							<a {if $info['mobile']} href="{$_W['siteroot']}app/index.php?i={$_W['uniacid']}&c=entry&do=list&m=viva_njyh_njfh_jfdh"{else} class="exlist" {/if}>查看</a>
						</div>
					</div>				
				</div>
			</div>
			<a class="integl_rule">积分兑换规则   >></a>			
		</div>
		<!--资料完善弹出框-->
		<div class="message_per_cover" style="display: none;">
			<div class="perfect_cov_box">
				<img class="perfect_close" src="{S_URL}img/close.png">			
				<div class="perfect_content">
					<div class="perfect_con_head">我的信息</div>
					<div class="perfect_info">
						<div><span>头像</span></div>
						<div style="position: relative;" class="avatar"><img src="{php echo $this->profile['avatar']}"></div>
					</div>
					<div class="perfect_info">
						<div><span>姓名</span></div>
						<div><input type="text" id="nickname" style="background: #fff;" disabled value="{php echo $this->profile['nickname']}"></div>
					</div>
					<div class="perfect_info">
						<div><span>性别</span></div>
						<div>
							<select id="gender">
								<!-- <option {if $info['gender'] == 0}selected{/if}>保密</option> -->
								<option {if $info['gender'] == 1}selected{/if}>男</option>
								<option {if $info['gender'] == 2}selected{/if}>女</option>
							</select>
						</div>
					</div>
					<div class="perfect_info">
						<div><span>年龄</span></div>
						<div><input type="number" id="age" maxlength="3" value="{php echo $info['age'] ? $info['age'] : '';}"></div>
					</div>
					<div class="perfect_info">
						<div><span>职业</span></div>
						<div>
							<select id="occupation">
								<option>请选择</option>
								<option>学生</option>
								<option>IT技术</option>
								<option>娱乐业</option>
								<option>文体工作</option>
								<option>医疗卫生</option>
								<option>农林牧渔</option>
								<option>餐饮旅游</option>
								<option>设计创意</option>
								<option>物流运输</option>
								<option>房地产</option>
								<option>财务审计</option>
								<option>能源动力</option>
								<option>个体经营</option>
								<option>军人警察</option>
								<option>美容保健</option>
								<option>行政后勤</option>
								<option>教育培训</option>
								<option>事业单位公务员</option>
								<option>公关媒介</option>
								<option>技工</option>
								<option>宗教人员</option>
								<option>新闻出版</option>
								<option>金融</option>
								<option>人力资源</option>
								<option>保险</option>
								<option>法律</option>
								<option>自由职业者</option>
								<option>待业/无业/失业</option>
								<option>其他</option>
							</select>
						</div>
					</div>
					<div class="perfect_info">
						<div><span>手机号</span></div>
						<div><input type="tel" id="telephone" value="{$info['mobile']}"></div>
					</div>
					<div class="perfect_info">
						<div style="-webkit-flex:2;">
							<input class="input_code" type="text" style="font-size: .26rem;border: none;width: 95%;text-align: left;" id="vcode" placeholder="请输入验证码">
						</div>
						<div style="-webkit-flex:1;">
							<button class="verify" style="width: 90%;height: .45rem;background: #fff;color:#ff4430;border: 1px solid #ff4430;border-radius: 3px;">获取验证码</button>
						</div>
					</div>
					<div class="perfect_info1">
						<div class="info_address">
							<span style="-webkit-flex:6;">联系地址</span>
							<div style="-webkit-flex:1;"><span class="word_number">0</span>/50</div>
						</div>
						<div>
							<textarea maxlength="50" class="info_text" id="address" placeholder="为了方便您兑换的奖品按时送达，请确认您所填写的地址真实有效。">{$info['address']}</textarea>
						</div>
					</div>
					<div class="perfect_info1" style="border: none;">
						<div class="info_address">
							<span style="-webkit-flex:6;">兴趣爱好</span>
							<div style="-webkit-flex:1;"><span class="word_number1">0</span>/20</div>
						</div>
						<div>
							<textarea maxlength="20" class="info_text1" id="interest">{$info['interest']}</textarea>
						</div>
					</div>
				</div>
				<a class="save_btn">保存</a>
			</div>
		</div>
		<!--积分兑换规则弹框-->
		<div class="message_per_cover1" style="display: none;">
			<div class="perfect_cov_box1">
				<img class="perfect_close1" src="{S_URL}img/close.png">	
				<div class="rule_content">
					<div class="rule_head"></div>
					<div class="rule_con_box">
						<p class="rule_p1">积分兑换规则</p>
						<div class="rule_div">
							<p>1.签到赚积分：通过个人中心签到/官微回复【签到】领取积分，单次领取2积分，每人每天仅可签到一次。</p>
							<p>2.阅读有礼积分领取：通过个人中心阅读有礼/官微图文底部阅读原文领积分，单条图文可领取2积分，每人每天最高可领取10积分。</p>
							<p>3.根据指定积分兑换相应奖品，每项奖品每月数量有限，兑完即止。</p>
						</div>
						<p class="rule_p2"><i style="font-style: normal;font-size: .4rem">*</i>最终解释权归南京银行南京分行所有</p>
					</div>
				</div>
				<div class="rule_di1"></div>
				<div class="rule_di2"></div>
			</div>
		</div>
		<!--登录框-->
		<div class="message_per_cover11" style="display: none;">
			<div class="perfect_cov_box1">
				<img class="perfect_close11" src="{S_URL}img/close.png">	
				<div class="rule_content4">
					<div class="rule_head"></div>
					<div class="rule_con_box">
						<div class="sign_in_name">
							<img src="{S_URL}img/person.png">
							<input class="input_name" type="text" disabled value="{php echo $this->profile['nickname']}">
						</div>
						<div class="sign_in_tel">
							<img src="{S_URL}img/phone.png">
							<input class="input_tel" type="tel" id="phone" placeholder="手机号">
						</div>
						<div class="sign_in_code" style="display: -webkit-flex;margin-top: .3rem">
							<div style="-webkit-flex:2;padding-left: .2rem;">
								<input class="input_code" type="text" style="padding-left: .2rem;border: none;width: 95%;padding-top: .2rem;border-bottom: 1px solid #ccc;" id="verifycode" placeholder="请输入验证码">
							</div>
							<div style="-webkit-flex:1;">
								<button class="verify" data-active="login" style="width: 90%;height: .45rem;background: #fff;color:#ff4430;border: 1px solid #ff4430;border-radius: 3px;">获取验证码</button>
							</div>
						</div>
						<a class="sign_in_btn">登录</a>
					</div>
				</div>
				<div class="rule_di1"></div>
				<div class="rule_di2"></div>
			</div>
		</div>
		<!--提示先登录框-->
		<div class="message_per_cover12" style="display: none;">
			<div class="perfect_cov_box1">
				<img class="perfect_close12" src="{S_URL}img/close.png">	
				<div class="rule_content5">
					<div class="rule_head"></div>
					<div class="rule_con_box">
						<p style="text-align: center; font-size:0.34rem; margin-top:0.7rem;">亲，请先登录哟~</p>
					</div>
				</div>
				<div class="rule_di1"></div>
				<div class="rule_di2"></div>
			</div>
		</div>
		{template 'wxsdk'}
		<script>
			$(document).ready(function() {
				var h = $(window).height();
				$(".perfect_cov_box").height(h * 0.9);
			});
			$("#occupation option").each(function() {
				if ("{$info['occupation']}" != "") {
					if ("{$info['occupation']}" == $(this).val()) {
						$(this)[0].selected = true;
					}
				}
			});
	    	var num = $('.info_text').val().length;
		    $('.word_number').text(num);
	    	var Number = $('.info_text1').val().length;			    
		    $('.word_number1').text(Number);
		    $('.info_text').keyup(function(){
		    	var num = $('.info_text').val().length;
			    $('.word_number').text(num);
		    });
		    $('.info_text1').keyup(function(){
		    	var Number = $('.info_text1').val().length;			    
			    $('.word_number1').text(Number);
		    })
		    var pro = false;
		    $(".verify").click(function() {
		    	var tel = /^1(3|4|5|7|8)\d{9}$/;
		    	_this = $(this);
		    	if (_this.data('active') == 'login') {
		    		phone = $("#phone").val();
			    	if (!phone || !tel.test(phone)) {
			    		alert('请输入有效的手机号码~');
			    		return false;
			    	}
		    	} else {
		    		phone = $("#telephone").val();
			    	if (!phone || !tel.test(phone)) {
			    		alert('请输入有效的手机号码~');
			    		return false;
			    	}
			    }
		    	_this.attr('disabled', 'disabled');
		    	$.post("{php echo $this->createMobileUrl('Sms')}", {phone : phone}, function(msg) {
		    		if (msg.status) {
		    			x = 60;
		    			var ctimes = setInterval(function() {
		    				x--;
		    				if (x == 0) {
		    					_this.text('获取验证码');
				    			_this.removeAttr('disabled', 'disabled');
				    			clearInterval(ctimes);
		    				} else {
			    				_this.text(x);
		    				}
		    			}, 1000);
		    		} else {
		    			_this.removeAttr('disabled', 'disabled');
			    		alert(msg.info);
		    		}
		    	}, 'json');
		    });
		    function sign(){
			    var tel = /^1(3|4|5|7|8)\d{9}$/;
			    if($("#phone").val() =='' || !tel.test($("#phone").val())){
			    	alert('请输入有效的手机号码~');
			    	$('.input_tel').focus();
			    	return false;
			    }
			    if (!$("#verifycode").val()) {
			    	alert('请输入验证码~')
			    	return false;
			    }
			    if (pro) return false;
			    pro = true;
			    var data = {mobile : $("#phone").val()};
			    $.post("{php echo $this->createMobileUrl('info')}", {"data" : data, verifycode : $("#verifycode").val()}, function(msg) {
			    	console.log(msg);
			    	if (msg.status) {
			    		location.href = location.href;
			    	} else {
			    		alert(msg.info);
			    	}
			    	pro = false;
			    }, 'json')
		    }
		    $(".sign_in_btn").click(function() {
		    	sign();
		    });
		    $('.reading, .rate, .exchange, .exlist').click(function(){
		    	$('.message_per_cover12').show();
		    })
		    $('.perfect_close12').click(function(){
		    	$('.message_per_cover12').hide();
		    })
		    $('.sign_btn').click(function(){
		    	$('.message_per_cover11').show();
		    })
		    $('.perfect_close11').click(function(){
		    	$('.message_per_cover11').hide();
		    })
		    $('.bianji').click(function(){
		    	$('.message_per_cover').show();
		    })
			$('.perfect_close').click(function(){
				$('.message_per_cover').hide();
			})
			$('.integl_rule').click(function(){
				$('.message_per_cover1').show();
			})
			$('.perfect_close1').click(function(){
				$('.message_per_cover1').hide();
			})
			$("#age").on('input', function() {
				if (String($(this).val()).length > 3) {
					$(this).val($(this).val().substring(0, 3));
				}
			});
			$(".save_btn").click(function() {
				var tel = /^1(3|4|5|7|8)\d{9}$/;
				if ($("#telephone").val() != '' && !tel.test($("#telephone").val())) {
			    	alert('请输入有效的手机号码~');
			    	$('.input_tel').focus();
					return false;
				}
				if ("{$info['mobile']}" != $("#telephone").val() && !$("vcode").val() && $("#telephone").val()) {
					alert('请输入验证码~');
					return false;
				}
				var gender;
				if ($("#gender").val() == "男") {
					var gender = 1;
				} else if ($("#gender").val() == "女") {
					var gender = 2;
				}
				var occupation = $("#occupation").val();
				if ($("#occupation").val() == '请选择') {
					var occupation = '';
				}
				var data = {
					gender : gender,
					age : $("#age").val(),
					occupation : occupation,
					mobile : $("#telephone").val(),
					address : $("#address").val(),
					interest : $("#interest").val()
				};
				if (pro) return false;
				pro = true;
				$.post("{php echo $this->createMobileUrl('info')}", {"data" : data, verifycode : $("vcode").val()}, function(msg) {
					if (msg.status) {
						location.href = location.href;
					} else {
						alert('更新资料失败！');
					}
					pro = false;
				}, 'json')
			});
			wx.ready(function() {
				$(".avatar").click(function() {
					wx.chooseImage({
					    count: 1, // 默认9
					    sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
					    sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
					    success: function (res) {
					        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
					        wx.previewImage({
							    current: '', // 当前显示图片的http链接
							    urls: localIds // 需要预览的图片http链接列表
							});
					    }
					});
				});
			});
		</script>
	</body>
</html>
